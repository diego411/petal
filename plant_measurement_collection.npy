# Constants
const ADC_PIN = C_PIN_06        # ACD input on IN06
const THRESHOLD = 5000

# Server Endpoints
URL = "http://192.168.178.42:5000/"
UPDATE_URL = URL + "update"
STATE_URL = URL + "state"

# Variables
i:int = 0
count:int = 0
out:byte[20000]
out = ""

# Draws the current emotional state and time stamp on the screen
def draw_state():
    dt:dateTime
    dt.now()
    clear()
    getRequest(STATE_URL)
    drawText(10, 10, readRequestJSON("current_emotion"))
    drawText(10, 100, dt.getHour() + ":" + dt.getMinute())
    update()

draw_state()

while(true):
    voltage = readADC(ADC_PIN, 2)

    hByte = byteToHex(voltage>>8)
    lByte = byteToHex(voltage&0xFF)

    index = 4*i  # das ist die Startvariable fÃ¼r das Byte-Muster
    out[index] = hByte[0]
    out[index+1] = hByte[1]
    out[index+2] = lByte[0]
    out[index+3] = lByte[1]

    i = i + 1

    if i >= THRESHOLD:
        i = 0
        count = count + 1

        addRequestHeader("Content-Type", "application/json")
        postRequest(UPDATE_URL, out)

        out = ""

        if count % 60 == 0:
            count = 0
            draw_state()
